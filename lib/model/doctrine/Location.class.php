<?php

/**
 * Location
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    HT
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 6485 2009-10-12 18:41:59Z jwage $
 */
class Location extends BaseLocation {
    public $plused = false;
    public $minused = false;

    public function getLatitudeOZI() {
        return DDDMConverter::DDToDM($this->getLatitude());
    }
    public function getLongitudeOZI() {
        return DDDMConverter::DDToDM($this->getLongitude());
    }

    public function getRating() {
        return Vote::getRating($this);
    }

    public function updateAddress($addressData) {
        if(!$this->isNew()) {
            $address = $this->getAddress();
        }else {
            $address = new Address();
        }
        fb($addressData);
        foreach ($addressData  as $partName => $name) {
            $part = $this->getAddressPart($addressData, $partName);
            $uPartName = ucfirst($partName);

            $address->$uPartName = $part ? $part : null;
        }

        $this->save();
        return $this;
    }

    private function getAddressPart($addressData, $partName) {
        $uPartName = ucfirst($partName);
        $name = $addressData[$partName];

        $part = Doctrine_Query::create()
            ->from($uPartName)
            ->where('name = ?', $name)
            ->fetchOne();

        if(!$part && $name) {
            $part = new $uPartName();
            $part->name = $name;
            fb('new part');
        }
        return $part;
    }
}